


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Model Devlopment Example : ToasterFacility &mdash; Cyclus Home</title>
    <link rel="stylesheet" href="../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="Cyclus Home" href="../../index.html" />
   
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-12222727-2']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

  </head>
  <body>
<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
  <a href="http://cyclus.github.com">
    <img src="../../_static/logo1.png"/>
  </a>
</div>


    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li><a href="../../index.html">Cyclus Home</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Model Devlopment Example : ToasterFacility</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#creating-new-models-of-the-existing-types">Creating New Models of the Existing Types</a><ul>
<li><a class="reference internal" href="#beginning-with-a-stub-template">Beginning With a Stub Template</a></li>
<li><a class="reference internal" href="#customization-of-the-relax-ng-grammar">Customization of the Relax-NG Grammar</a></li>
<li><a class="reference internal" href="#customization-of-the-init-function">Customization of the init function</a></li>
<li><a class="reference internal" href="#customization-of-the-documentation-comments">Customization of the Documentation Comments</a></li>
<li><a class="reference internal" href="#customization-of-the-template">Customization of The Template</a></li>
</ul>
</li>
<li><a class="reference internal" href="#creating-specific-model-types">Creating Specific Model Types</a><ul>
<li><a class="reference internal" href="#a-note-to-core-developers">A Note To Core Developers</a></li>
</ul>
</li>
<li><a class="reference internal" href="#extending-loadable-modules-to-other-types-outdated">Extending Loadable Modules to Other Types (outdated)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#references">References</a></li>
</ul>

<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <p>s
.. summary Specific Step-by-Step instructions for creating a ToasterFacility</p>
<div class="section" id="model-devlopment-example-toasterfacility">
<h1>Model Devlopment Example : ToasterFacility<a class="headerlink" href="#model-devlopment-example-toasterfacility" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>The instructions here will use a fictional example (a Toaster) to describe the
specific steps to take in order to easily add a custom module to the Cyclus
framework. The module pursued here is a Facility type module which converts a
<cite>bread</cite> Material Resource into a <cite>toast</cite> Material Resource. In order to do this,</p>
</div>
<div class="section" id="creating-new-models-of-the-existing-types">
<h2>Creating New Models of the Existing Types<a class="headerlink" href="#creating-new-models-of-the-existing-types" title="Permalink to this headline">¶</a></h2>
<p>For each type of model (i.e. Market, Facility, Institution, or Region), a set of
stub files are available as skeletons for the new models.  When creating a new
model, it is important that all the functionality defined in these files remains
in the final model definition.</p>
<div class="section" id="beginning-with-a-stub-template">
<h3>Beginning With a Stub Template<a class="headerlink" href="#beginning-with-a-stub-template" title="Permalink to this headline">¶</a></h3>
<p>To create a new model, e.g. a new FacilityModel of type ToasterFacility:</p>
<ol class="arabic simple">
<li>Copy the StubFacility directory and all of the files it contains to a new
directory called ToasterFacility.</li>
<li>Rename the Stub* files within that directory to corresponding Toaster* files.
(That is, rename StubFacility.cpp to ToasterFacility.cpp, etc.)</li>
<li>Search instances of <cite>Stub</cite> and <cite>STUB</cite> within those files and replace them
with <cite>Toaster</cite> and <cite>TOASTER</cite>. That is, code such as:</li>
</ol>
<div class="highlight-cpp"><div class="highlight"><pre><span class="cp">// StubFacility.h</span>
<span class="cp">#if !defined(_STUBFACILITY_H)</span>
<span class="cp">#define _STUBFACILITY_H</span>

<span class="cp">#include &quot;Logger.h&quot;</span>
<span class="cp">#include &quot;FacilityModel.h&quot;</span>

<span class="k">class</span> <span class="nc">StubFacility</span> <span class="o">:</span> <span class="k">public</span> <span class="n">FacilityModel</span>  <span class="c1">// ...</span>
</pre></div>
</div>
<p>would become :</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="cp">// ToasterFacility.h</span>
<span class="cp">#if !defined(_TOASTERFACILITY_H)</span>
<span class="cp">#define _TOASTERFACILITY_H</span>

<span class="cp">#include &quot;Logger.h&quot;</span>
<span class="cp">#include &quot;FacilityModel.h&quot;</span>

<span class="k">class</span> <span class="nc">ToasterFacility</span> <span class="o">:</span> <span class="k">public</span> <span class="n">FacilityModel</span>  <span class="c1">// ...</span>
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li>Add a new add_subdirectory line to the CMakeLists.txt file in the Facility
directory. That should look something like :</li>
</ol>
<div class="highlight-cmake"><pre># Build the cyclus executable from the CYCLUS_SRC source files
ADD_SUBDIRECTORY( ConditioningFacility )
ADD_SUBDIRECTORY( EnrichmentFacility )
...
ADD_SUBDIRECTORY( ToasterFacility )

SET(ModelTestSource ${ModelTestSource} ${FacilityTestSource} PARENT_SCOPE)</pre>
</div>
</div>
<div class="section" id="customization-of-the-relax-ng-grammar">
<h3>Customization of the Relax-NG Grammar<a class="headerlink" href="#customization-of-the-relax-ng-grammar" title="Permalink to this headline">¶</a></h3>
<p>The parameters that define a Toaster are :</p>
<ul class="simple">
<li><strong>nSlices</strong> :  How many slices it can toast at once [ integer number of slices ]</li>
<li><strong>toastiness</strong> : How toasted they become [ light, golden, dark, burnt ]</li>
<li><strong>rate</strong> : How long it takes to toast a set of slices [ minutes ]</li>
<li><strong>incommodity</strong> : The commodity market in which slices of bread are traded in
this simulation [ a string ]</li>
<li><strong>outcommodity</strong> : The commodity market in which toasted bread is traded in this
simulation [ a string ]</li>
</ul>
<p>To tell the cyclus framework that this is the necessary information to define a
ToasterFacility, we include a Relax-NG grammar file. The stub looks like :</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;grammar</span> <span class="na">xmlns=</span><span class="s">&quot;http://relaxng.org/ns/structure/1.0&quot;</span>
<span class="na">datatypeLibrary=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-datatypes&quot;</span><span class="nt">&gt;</span>

<span class="nt">&lt;define</span> <span class="na">name=</span><span class="s">&quot;ToasterFacility&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;element</span> <span class="na">name=</span><span class="s">&quot;ToasterFacility&quot;</span><span class="nt">&gt;</span> <span class="nt">&lt;ref</span> <span class="na">name=</span><span class="s">&quot;incommodity&quot;</span><span class="nt">/&gt;</span>
     <span class="nt">&lt;oneOrMore&gt;</span>
       <span class="nt">&lt;ref</span> <span class="na">name=</span><span class="s">&quot;outcommodity&quot;</span><span class="nt">/&gt;</span>
     <span class="nt">&lt;/oneOrMore&gt;</span>
    <span class="nt">&lt;/element&gt;</span>
 <span class="nt">&lt;/define&gt;</span>
</pre></div>
</div>
<p>To customize it to include the parameters above, change it to look like :</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;grammar</span> <span class="na">xmlns=</span><span class="s">&quot;http://relaxng.org/ns/structure/1.0&quot;</span>
<span class="na">datatypeLibrary=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-datatypes&quot;</span><span class="nt">&gt;</span>

<span class="nt">&lt;define</span> <span class="na">name=</span><span class="s">&quot;ToasterFacility&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;element</span> <span class="na">name=</span><span class="s">&quot;ToasterFacility&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;element</span> <span class="na">name=</span><span class="s">&quot;nSlices&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;data</span> <span class="na">type=</span><span class="s">&quot;nonNegativeInteger&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/element&gt;</span>
    <span class="nt">&lt;element</span> <span class="na">name=</span><span class="s">&quot;toastiness&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;data</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/element&gt;</span>
    <span class="nt">&lt;element</span> <span class="na">name=</span><span class="s">&quot;rate&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;data</span> <span class="na">type=</span><span class="s">&quot;double&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/element&gt;</span>
    <span class="nt">&lt;ref</span> <span class="na">name=</span><span class="s">&quot;incommodity&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;ref</span> <span class="na">name=</span><span class="s">&quot;outcommodity&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/element&gt;</span>
 <span class="nt">&lt;/define&gt;</span>
</pre></div>
</div>
<p>There are a few things to notice here.</p>
<ul class="simple">
<li>The incommodity and outcommodity elements are already defined. Since these are
common module parameters, they can be used by reference (note the ref syntax)
in any rng file within the simulation.</li>
<li>The data types of the parameters are defined by the datatypeLibrary referenced
in the top line. The documentation for this datatype library can be found at
the url. This is provided only for convenience, and allows the XML parser to
check the datatype of user input.</li>
<li>The toastiness parameter is passed as a string. This means that the
input error checking, string interpretation, and other parsing that must be
done to ensure that the value provided is within the available (light, golden,
dark, burnt) options must be done in the initialization function on the c++
side. Though this parameter could have been defined in other ways, thisi is a good
example of how to arrage to do the input parsing task outside of xml. <strong>Note that
such a string parameter could also be used to provide the name of another input
file that helps define a module. The interpretation, again, would have to be
done on the c++ side</strong></li>
</ul>
</div>
<div class="section" id="customization-of-the-init-function">
<h3>Customization of the init function<a class="headerlink" href="#customization-of-the-init-function" title="Permalink to this headline">¶</a></h3>
<p>In order for your module to have access to these parameters that define a
configured prototype the init function must load the data from XML. The
ToasterFacility.cpp file changes from :</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="c1">//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<span class="kt">void</span> <span class="n">ToasterFacility</span><span class="o">::</span><span class="n">init</span><span class="p">(</span><span class="n">xmlNodePtr</span> <span class="n">cur</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">FacilityModel</span><span class="o">::</span><span class="n">init</span><span class="p">(</span><span class="n">cur</span><span class="p">);</span>
  <span class="c1">/// move XML pointer to current model</span>
  <span class="n">cur</span> <span class="o">=</span> <span class="n">XMLinput</span><span class="o">-&gt;</span><span class="n">get_xpath_element</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span><span class="s">&quot;model/ToasterFacility&quot;</span><span class="p">);</span>
  <span class="c1">/// initialize any ToasterFacility-specific datamembers here</span>
<span class="p">}</span>
</pre></div>
</div>
<p>To :</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="c1">//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<span class="kt">void</span> <span class="n">ToasterFacility</span><span class="o">::</span><span class="n">init</span><span class="p">(</span><span class="n">xmlNodePtr</span> <span class="n">cur</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">FacilityModel</span><span class="o">::</span><span class="n">init</span><span class="p">(</span><span class="n">cur</span><span class="p">);</span>
  <span class="c1">/// move XML pointer to current model</span>
  <span class="n">cur</span> <span class="o">=</span> <span class="n">XMLinput</span><span class="o">-&gt;</span><span class="n">get_xpath_element</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span><span class="s">&quot;model/ToasterFacility&quot;</span><span class="p">);</span>
  <span class="c1">/// initialize any ToasterFacility-specific datamembers here</span>
  <span class="n">n_slices_</span> <span class="o">=</span> <span class="n">strtol</span><span class="p">(</span><span class="n">XMLinput</span><span class="o">-&gt;</span><span class="n">get_xpath_content</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;rate&quot;</span><span class="p">),</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
  <span class="n">toastiness_</span> <span class="o">=</span> <span class="n">XMLinput</span><span class="o">-&gt;</span><span class="n">get_xpath_content</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span><span class="s">&quot;toastiness&quot;</span><span class="p">);</span>
  <span class="n">rate_</span> <span class="o">=</span> <span class="n">strtod</span><span class="p">(</span><span class="n">XMLinput</span><span class="o">-&gt;</span><span class="n">get_xpath_content</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;rate&quot;</span><span class="p">),</span> <span class="nb">NULL</span><span class="p">);</span>
  <span class="n">incommodity_</span> <span class="o">=</span> <span class="n">XMLinput</span><span class="o">-&gt;</span><span class="n">get_xpath_content</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;incommodity&quot;</span><span class="p">);</span>
  <span class="n">outcommodity_</span> <span class="o">=</span> <span class="n">XMLinput</span><span class="o">-&gt;</span><span class="n">get_xpath_content</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;outcommodity&quot;</span><span class="p">);</span>

  <span class="c1">// check that toastiness_ is oneof the allowed levels :</span>
  <span class="c1">// this gives an example of performing input checking in the module</span>
  <span class="c1">// in case the xml parser is not detailed enough</span>
  <span class="n">string</span> <span class="n">levels_array</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;light&quot;</span><span class="p">,</span> <span class="s">&quot;golden&quot;</span><span class="p">,</span> <span class="s">&quot;dark&quot;</span><span class="p">,</span> <span class="s">&quot;burnt&quot;</span><span class="p">};</span>
  <span class="n">set</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">allowed_levels</span><span class="p">(</span><span class="n">levels_array</span><span class="p">,</span> <span class="n">levels_array</span><span class="o">+</span><span class="mi">4</span><span class="p">);</span>
  <span class="k">if</span> <span class="o">!</span><span class="n">allowed_levels</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">toastiness_</span><span class="p">){</span>
    <span class="n">string</span> <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;The value given for the darkenss parameter, &quot;</span><span class="p">;</span>
    <span class="n">msg</span> <span class="o">+=</span> <span class="n">toastiness_</span><span class="p">;</span>
    <span class="n">msg</span> <span class="o">+=</span> <span class="s">&quot;, is not within the allowed set. Allowed values are: &quot;</span><span class="p">;</span>
    <span class="n">set</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;::</span><span class="n">iterator</span> <span class="n">it</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">it</span><span class="o">=</span><span class="n">allowed_levels</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="n">it</span> <span class="o">!=</span> <span class="n">allowed_levels</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="n">it</span><span class="o">++</span><span class="p">){</span>
      <span class="n">msg</span> <span class="o">+=</span> <span class="s">&quot; &quot;</span><span class="p">;</span>
      <span class="n">msg</span> <span class="o">+=</span> <span class="p">(</span><span class="o">*</span><span class="n">it</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">msg</span><span class="o">+=</span><span class="s">&quot;.&quot;</span><span class="p">;</span>
    <span class="k">throw</span> <span class="n">CycException</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>These member variables must be declared in the ToasterFacility.h header file. The header file originally has a section that looks like :</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="cm">/* --------------------</span>
<span class="cm"> * _THIS_ FACILITYMODEL class has these members</span>
<span class="cm"> * --------------------</span>
<span class="cm"> */</span>

<span class="cm">/* ------------------- */</span>

<span class="p">};</span>
</pre></div>
</div>
<p>We change it to include :</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="cm">/* --------------------</span>
<span class="cm"> * _THIS_ FACILITYMODEL class has these members</span>
<span class="cm"> * --------------------</span>
<span class="cm"> */</span>

 <span class="k">private</span><span class="o">:</span>
  <span class="cm">/**</span>
<span class="cm">   * The number of slices the toaster can handle at one time</span>
<span class="cm">   */</span>
  <span class="kt">int</span> <span class="n">n_slices_</span><span class="p">;</span>

  <span class="cm">/**</span>
<span class="cm">   * The speed (set of slices per minute) with which the toaster toasts</span>
<span class="cm">   */</span>
  <span class="kt">double</span> <span class="n">rate_</span><span class="p">;</span>

  <span class="cm">/**</span>
<span class="cm">   * The toastiness of the toast. This can be &#39;light&#39;, &#39;golden&#39;, &#39;dark&#39; or &#39;burnt&#39;.</span>
<span class="cm">   */</span>
  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">toastiness_</span><span class="p">;</span>

  <span class="cm">/**</span>
<span class="cm">   * The name of the commodity market for the incoming commodity.</span>
<span class="cm">   */</span>
  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">incommodity_</span><span class="p">;</span>

  <span class="cm">/**</span>
<span class="cm">   * The name of the commodity market for the outgoing commodity.</span>
<span class="cm">   */</span>
  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">outcommodity_</span><span class="p">;</span>


<span class="cm">/* ------------------- */</span>

<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="customization-of-the-documentation-comments">
<h3>Customization of the Documentation Comments<a class="headerlink" href="#customization-of-the-documentation-comments" title="Permalink to this headline">¶</a></h3>
<p>To build documentation of your module into the doxygen documentation you or your
users build locally, your code must contain informative, Doxygen style comments
to describe the classes and functions that define your module. More details of
this are discussed in the style guide, but the Stub files give a good begining.</p>
<p>For our ToasterFacility, the ToasterFacility.h file, for instance, has a section
that looks like :</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="cp">// ToasterFacility.h</span>
<span class="cp">#if !defined(_TOASTERFACILITY_H)</span>
<span class="cp">#define _TOASTERFACILITY_H</span>

<span class="cp">#include &quot;Logger.h&quot;</span>
<span class="cp">#include &quot;FacilityModel.h&quot;</span>

<span class="cm">/**</span>
<span class="cm">  @class ToasterFacility</span>

<span class="cm">  @brief This FacilityModel is intended</span>
<span class="cm">  as a skeleton to guide the implementation of new FacilityModel models.</span>

<span class="cm">  The ToasterFacility class inherits from the FacilityModel class and is</span>
<span class="cm">  dynamically loaded by the Model class when requested.</span>

<span class="cm">  @section intro Introduction</span>
<span class="cm">  Place an introduction to the model here.</span>

<span class="cm">  @section modelparams Model Parameters</span>
<span class="cm">  Place a description of the required input parameters which define the model</span>
<span class="cm">  implementation.</span>

<span class="cm">  @section optionalparams Optional Parameters</span>
<span class="cm">  Place a description of the optional input parameters to define the model</span>
<span class="cm">  implementation.</span>

<span class="cm">  @section detailed Detailed Behavior</span>
<span class="cm">  Place a description of the detailed behavior of the model. Consider describing</span>
<span class="cm">  the behavior at the tick and tock as well as the behavior upon sending and</span>
<span class="cm">  receiving materials and messages.</span>
<span class="cm">*/</span>
</pre></div>
</div>
<p>This should looke more like :</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="cp">// ToasterFacility.h</span>
<span class="cp">#if !defined(_TOASTERFACILITY_H)</span>
<span class="cp">#define _TOASTERFACILITY_H</span>

<span class="cp">#include &quot;Logger.h&quot;</span>
<span class="cp">#include &quot;FacilityModel.h&quot;</span>

<span class="cm">/**</span>
<span class="cm">  @class ToasterFacility</span>

<span class="cm">  @brief This FacilityModel is intended to toast material objects</span>

<span class="cm">  The ToasterFacility class inherits from the FacilityModel class and is</span>
<span class="cm">  dynamically loaded by the Model class when requested.</span>

<span class="cm">  @section intro Introduction</span>
<span class="cm">  A toaster is a common household implment which adds some carbon to our</span>
<span class="cm">  slices of bread. It usually takes about a minute to heat a slice of bread</span>
<span class="cm">  until it is golden brown.</span>

<span class="cm">  @section modelparams Model Parameters</span>
<span class="cm">  To fully define a Toaster prototype, the following parameters must be</span>
<span class="cm">  defined :</span>
<span class="cm">  - int nSlices :  How many slices it can toast at once [ integer number of slices ]</span>
<span class="cm">  - string toastiness : How toasted they become [ light, golden, dark, burnt ]</span>
<span class="cm">  - double rate : How long it takes to toast a set of slices [ minutes ]</span>
<span class="cm">  - string incommodity : The commodity market in which slices of bread are traded</span>
<span class="cm">  - string outcommodity : The commodity market in which toasted bread is traded</span>

<span class="cm">  @section optionalparams Optional Parameters</span>
<span class="cm">  This model has no optional parameters.</span>

<span class="cm">  @section detailed Detailed Behavior</span>
<span class="cm">  The ToasterFacility starts operation immediately.</span>

<span class="cm">  @subsection tick On the tick :</span>
<span class="cm">  The ToasterFacility immediately offers any toast that exists in the inventory from</span>
<span class="cm">  previous months and begins to request the incommodity. It requests as much sliced</span>
<span class="cm">  bread as it can toast within a timestep. That is, it requests 86400 slices if</span>
<span class="cm">  the timestep is 30 days long, the rate is 2 minutes per set of slices, and</span>
<span class="cm">  n_slices = 4.</span>

<span class="cm">  @subsection receive Receiving a Message :</span>
<span class="cm">  If the request is matched with an offer from another facility,</span>
<span class="cm">  the ToasterFacility executes that order by adding that quantity to its stocks.</span>

<span class="cm">  @subsection tock On the tock :</span>
<span class="cm">  On the tock, the ToasterFacility alters the isotopic vectors of each slice of</span>
<span class="cm">  bread in the stocks (up to the monthly capacity) to include more carbon and less</span>
<span class="cm">  oxygen (the magnitude of the change is defined by the toastiness parameter). Each</span>
<span class="cm">  (now toasted) slice is then placed in the inventory.</span>

<span class="cm">*/</span>
</pre></div>
</div>
</div>
<div class="section" id="customization-of-the-template">
<h3>Customization of The Template<a class="headerlink" href="#customization-of-the-template" title="Permalink to this headline">¶</a></h3>
<p>All models must provide a number of functions for which you have copied the
minium functioning version. This tutorial will address the steps with which to
customize each of those functions.
These functions are :</p>
<ul class="simple">
<li>a method named &#8216;init&#8217; to initialize an instance of the model from an XML
node pointer (xmlNodePtr)<ul>
<li>this method must call the parent class method of the same name (e.g.
FacilityModel::init(cur))</li>
<li>this method should only initialize variables that are NOT members of the
parent class</li>
</ul>
</li>
<li>a method named &#8216;copy&#8217; to initialize an instance of the model from another
instance of the same model<ul>
<li>this method must call the parent class method of the same name (e.g.
FacilityModel::copy(src))</li>
<li>this method should only initialize variables that are NOT members of the
parent class</li>
</ul>
</li>
<li>a method named &#8216;print&#8217; to print a description of the model<ul>
<li>this method should call the parent class method of the same name (e.g.
FacilityModel::print())</li>
<li>this method should only print information that is NOT part of the parent
class(es)</li>
<li>this method assumes that a dangling output line (no std::endl) is left
from the parent class output</li>
</ul>
</li>
<li>a global construct function used to instantiate
objects of this model type. It is defined, for example, as follows</li>
</ul>
<div class="highlight-cpp"><div class="highlight"><pre><span class="k">extern</span> <span class="s">&quot;C&quot;</span> <span class="n">Model</span><span class="o">*</span> <span class="n">constructToasterFacility</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">ToasterFacility</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="creating-specific-model-types">
<h2>Creating Specific Model Types<a class="headerlink" href="#creating-specific-model-types" title="Permalink to this headline">¶</a></h2>
<p>For further details about creating new models of particular types, consult the
Model-specific reference:</p>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="facility.html">Developing Region Models</a><ul>
<li class="toctree-l2"><a class="reference internal" href="facility.html#details">Details</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="institution.html">Developing Institution Models</a><ul>
<li class="toctree-l2"><a class="reference internal" href="institution.html#details">Details</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="region.html">Developing Region Models</a><ul>
<li class="toctree-l2"><a class="reference internal" href="region.html#details">Details</a></li>
<li class="toctree-l2"><a class="reference internal" href="region.html#to-do">To Do</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="market.html">Developing Market Models</a><ul>
<li class="toctree-l2"><a class="reference internal" href="market.html#details">Details</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="a-note-to-core-developers">
<h3>A Note To Core Developers<a class="headerlink" href="#a-note-to-core-developers" title="Permalink to this headline">¶</a></h3>
<p>It is very important to keep the Stub files in the Models directory (or in each
of the model sub-directories) current.  As the Model.h definition is
improved/enhanced/developed, each of the model types will have to be updated to
be consistent.  Treat the StubModel and the StubCommModel in the same way as
others to ensure it remains up-to-date.</p>
<p>Similarly if a single model type is updated, e.g. MarketModel.h, with new
capability, each of the implemented models will need to be updated to be
consistent.  Treat the Stub`*` Models in each sub-directory in the same way as
the others to ensure it remains up-to-date.</p>
</div>
</div>
<div class="section" id="extending-loadable-modules-to-other-types-outdated">
<h2>Extending Loadable Modules to Other Types (outdated)<a class="headerlink" href="#extending-loadable-modules-to-other-types-outdated" title="Permalink to this headline">¶</a></h2>
<p>The current code already has support for loadable modules for MarketModel,
FacilityModel, InstModel, and RegionModel. These are all derived from base
class Model defined in <cite>src/Models/Model.h</cite>.  To support extension of this
capability to other types of models, the files <cite>src/Models/StubModel.h</cite> &amp;
<cite>src/Models/StubModel.cpp</cite> is provided.  (Stubs are also provided for new
Models that are also Communicators: <cite>src/Models/StubCommModel.h</cite> &amp;
<cite>src/Models/StubCommModel.cpp</cite>.)</p>
<p>To extend to a new model type, e.g. NewTypeModel:</p>
<blockquote>
<div><ul>
<li><p class="first">copy StubModel.h &amp; StubModel.cpp to a new location, NewTypeModel.h &amp;
NewTypeModel.cpp, respectively</p>
</li>
<li><p class="first">change the internal references to StubModel to NewTypeModel</p>
</li>
<li><p class="first">add NewTypeModel.cpp to the list of sources in the top level CMakeLists.txt file</p>
</li>
<li><p class="first">add a sub-directory (e.g. NewType) to the Models directory for your models</p>
<blockquote>
<div><ul class="simple">
<li>this directory name will become a keyword and should match the model name</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">create a StubNewType.h and StubNewType.cpp file in that sub-directory that
are stubs for new models of that type (you may want to copy the files
Stub/StubStub.h and Stub/StubStub.cpp)</p>
<blockquote>
<div><ul class="simple">
<li>follow the directions for creating a new model above to make a Stub for
your NewType model</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
<p>All new models types must include:</p>
<blockquote>
<div><ul>
<li><p class="first">a default constructor that</p>
<blockquote>
<div><ul class="simple">
<li>assigns the current value of nextID to the ID member variable and
increments nextID</li>
<li>assigns a string that matches the model name to <cite>model_type</cite></li>
<li>(for Communicators, this should also assign the correct value to
<cite>commType</cite>)</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">a method named &#8216;init&#8217; to initialize an instance of the model from an XML
node pointer (xmlNodePtr)</p>
<blockquote>
<div><ul class="simple">
<li>this method must call the parent class method Model::init(cur)</li>
<li>this method should only initialize variables that are NOT members of the
parent class</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">a method named &#8216;copy&#8217; to initialize an instance of the model from another
instance of the same model</p>
<blockquote>
<div><ul class="simple">
<li>this method must call the parent class method Model::copy(src)</li>
<li>(for Communicators, this method must call that parent class method
Communicator::copy(src))</li>
<li>this method should only initialize variables that are NOT members of the
parent class</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">a method named &#8216;print&#8217; to print a description of the model</p>
<blockquote>
<div><ul class="simple">
<li>this method should call the parent class method of the same name (e.g.
MarketModel::print())</li>
<li>this method should only print information that is NOT part of the parent
class(es)</li>
<li>this method assumes that a dangling output line (no std::endl) is left
from the parent class output</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
<p>Other notes on introducing new Model types:</p>
<blockquote>
<div><ul class="simple">
<li>You will probably need to extend the input parsing for this new Model type.
Since the primary input for <em>Cyclus</em> uses XML, you will certainly need to
add code to recognize and process primitives for this Model type.  While
you could, in theory, add a completely new input paradigm for Models of
this type, you might need to extend the <em>Cyclus</em> grammar to include support
for your Models.</li>
<li>You will probably need to create a primary storage location for your new
models in <em>Cyclus</em>.  Currently, most models are somehow registered with the
Logician (exception: InstModel are only registered with their containing
Region). You will need to extend the code appropriately to give a home to
your new models.</li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="references">
<h1>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h1>
<blockquote>
<div><ol class="arabic simple">
<li><a class="reference external" href="http://oss.sgi.com/LDP/HOWTO/C++-dlopen/index.html">C++ dlopen mini HOWTO</a></li>
<li><a class="reference external" href="http://www.yolinux.com/TUTORIALS/LibraryArchives-StaticAndDynamic.html">Static, Shared Dynamic and Loadable Linux Libraries</a></li>
</ol>
</div></blockquote>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li><a href="../../index.html">Cyclus Home</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Robert Carlsen.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.7.
    </div>
  </body>
</html>